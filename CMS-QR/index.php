<?php
      ####################################################
      ####################################################
      ###                                              ###
      ###  # # # # # # # # # # # # # # # # # # # #     ###
      ###   # # # # # # # # # # # # # # # # # # # #    ###
      ###    # # # # # # # # # # # # # # # # # # # #   ###
      ###     #     WDGSS Required File     # # # # #  ###
      ###    # Please No Change In This File # # # #   ###
      ###   # # # # # # # # # # # # # # # # # # # #    ###
      ###  # # # # # # # # # # # # # # # # # # # #     ###
      ###                                              ###
      ####################################################
      ####################################################
      ### WARNING DO NOT EDIT THIS FILE, THAT MISMATCH ###
      ### THE USABILITY OF WDGSS, WE DO NOT GIVE ----- ###
      ### SUPPORT FOR EDITTED FILES!!!!!!!!!!!!!!!!!!! ###
      ####################################################
      ####################################################
	  ### STARTED BY: Wesley De Groot (wes@wdgss.nl)   ###
	  ### FILE VERSION: 6.0.0.1-25                     ###
	  ### WDGSS VERSION: 6.0.0.1 Final                 ###
      ####################################################
	  ### LAST EDIT BY: Wesley De Groot (wes@wdgss.nl) ###
	  ### LAST REVISION: 20:12 @ 15 / 09 / 2010        ###
	  ####################################################
	  ####################################################
















session_start();
 define('in_wdgss',true);     # SET SECURITY
 include "include/core.php";  # LOAD ALL THINGS
 # EX: Modules; Configs; Anti-Hack Stuff; &more;
 
 if ( $conf['database']['db']->query('X')==false )
 {
  exit ( ' I Can`t Make A Query! ' ) ;
 }
 
 if ( isset ( $_GET['pag'] )) {
  if ( !preg_match ("/\./",$_GET['pag'] ) && 
       !preg_match ("/http\:\/\//",$_GET['pag']) &&
       !preg_match ("/https\:\/\//",$_GET['pag']) &&
	   !preg_match ("/ftp\:\/\//",$_GET['pag']) &&
	   !preg_match ("/403/", $_GET['pag'])
	   ) 
  {
  	$do  = $conf['database']['db']->query("SELECT * FROM `{$conf['database']['pref']}pages` WHERE `page`='" . secure($_GET['pag']) . "';");
	$sql = $conf['database']['db']->fetch($do,'array');
	$sql = $sql[0];
	if ( isset ( $sql['content'] ) ) 
	{
	 if ( strlen ( $sql['content'] ) < 5 )
		{
			unset ( $sql ) ;
		}
	 Else
		{
			null;
		}
	}
	
	  if ( $_GET['pag'] == "easteregg" )
	  {
		$x = "<marquee behavior='alternate' >.o/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\o.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\o/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.o/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\o.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\o/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.o/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\o.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\o/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</marquee>";
			$Z = "Hey You Found My Easter Egg!<br>{$x}<br><marquee direction='up' scrollamount='2'><center><h1>Wesley De groot</h1><h2>Presents</h2><h3>WesDeGroot Site System</h3></center><br><br><br>Thanks For Using My Cms.<br>If You Want More Things In WDGSS Then Don't Be Afraid And Email Me NOW :D<br>if you dare.....<br><br><br>ok, Seriously <br><br><br>I Want to Thanks These Special People <br><b><u>June Wessels, Being my Girlfriend And All The Positive Things In My live</u></b><br>H.F. Balk, My Mom :P<br>P.H.G. De Groot, My Dad.<br>C.M.L. V/D Eeden, A Special Person To Me<br>R. Cremer, The Boyfriend Of C.M.L V/D Eeden<br>Hans Blaauw, Another Special Person To Me (And Have Helped Me Out Of Regex (When He was drunk!))<br>Patrick Ekkel, The Person Who Helped Me To Am What I Am, And Accept It, And My Hoster & Special Friend :)<br>M. Wolvekamp, A Verry Special Person To Me.<br>Eric R, A Verry Special Person/Best Friend To Me<br>Edwin H, A Verry Special Person/Friend To Me<br><br>Did I Forgot You? No, That`s Almost Not Possible!<br>But If You Are Sure Contact Me :)<br></marquee><br>{$x}";
			$E = "<script type=\"text/javascript\">document.title='WesDeGroot Site System: Easter Egg';</script>" . overlay($Z);
			if ( file_exists ( "pages/home.php" ) ) 
				{
				   ob_start();
				   $i = include "pages/home.php";
				   $i = ob_get_contents();
				   ob_end_clean();
				   themed('home',$i.$E);
				}else{exit("MISSING HOMEPAGE");}		
	  }
 
  	  elseif ( file_exists ( "modules/" . $_GET['pag'] . "/page.php" ) )
	  {
		 $d = $_GET['pag'];
		 if ( file_exists ( 'modules/' . $d .'/lang/' . lang . '.php' ) )
			{
				include 'modules/' . $d .'/lang/' . lang . '.php';
				$l = lang;
			}
		 elseif ( file_exists ( 'modules/' . $d .'/lang/en.php' ) )
			{
				include 'modules/' . $d .'/lang/en.php';
				$l = 'en';
			}
		 else
			{
				exit("Missing Language File(s) (Ex: en,nl.. Now: " . lang . ") For Module {$d}.");
			}

	   ob_start();
	   $i = include "modules/" . $_GET['pag'] . "/page.php";
	   $i = ob_get_contents();
	   ob_end_clean();
	   themed($_GET['pag'],$i);
	  }
	  elseif ( file_exists( "pages/". $_GET['pag'] . ".php" ) ) 
	  {
	   ob_start();
	   $i = include "pages/" . $_GET['pag'] . ".php";
	   $i = ob_get_contents();
	   ob_end_clean();
	   if ( empty($i) Or $i=='t' Or strlen($i) < 5 )
			{
				$i = "Page Is Empty";
			}
	   themed($_GET['pag'],$i);
	  }
	  elseif ( isset($sql['page']) && isset($sql['content']) ) 
	  {
	   @ob_start();
	   $ob = eval("/**/ ?>" . $sql['content'] . "<?php /**/");
	   $ob = @ob_get_contents();
	   @ob_end_clean();
	   if ( empty($ob) Or $ob=='t' Or strlen($ob) < 5 )
			{
				$ob = overlay("Page Is Empty!");
			}
	   themed($sql['page'],$ob);
	  }
	  else
	  {
	    $E = overlay("<table><tr><td><img src='/template/admin/images/error.png' width='100' height='100'></td><td>".sprintf($lang['site']['error']['404'],urldecode($_SERVER['REQUEST_URI']))."</td></tr></table>");
		if ( file_exists ( "pages/home.php" ) ) 
			{
			   ob_start();
			   $i = include "pages/home.php";
			   $i = ob_get_contents();
			   ob_end_clean();
			   themed('home',$i.$E);
			}
		else
			{
				exit("MISSING HOMEPAGE");
			}
	  }
  }
  else
  {
	    $E = overlay("<table><tr><td><img src='/template/admin/images/error.png' width='100' height='100'></td><td>".sprintf($lang['site']['error']['403'],urldecode($_SERVER['REQUEST_URI']))."</td></tr></table>");
		if ( file_exists ( "pages/home.php" ) ) 
			{
			   ob_start();
			   $i = include "pages/home.php";
			   $i = ob_get_contents();
			   ob_end_clean();
			   themed('home',$i.$E);
			}
		else
			{
				exit("MISSING HOMEPAGE");
			}
  }
 }
 else
 {
	if ( isset ( $_GET['error'] ) )
		{
			{
				$_GET['error'] = preg_replace ( "#_#", "&nbsp;", $_GET['error'] ) ;
				$E = overlay("<table><tr><td><img src='/template/admin/images/error.png' width='100' height='100'></td><td>" . secure($_GET['error']) . "</td></tr></table>");
				$_GET['pag'] = 'home';
				if ( file_exists ( "pages/home.php" ) ) 
					{
						ob_start();
						$i = include "pages/home.php";
						$i = ob_get_contents();
						ob_end_clean();
						themed('home', $i . $E);
					}
				else
					{
						exit("MISSING HOMEPAGE");
					}
			}
		}
	else
		{
			header("location: {$conf['site']['url']}page/home");
		} 
 }
?>